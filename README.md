# üìé Recursive Include Preprocessor

–£—Ç–∏–ª–∏—Ç–∞ –Ω–∞ C++ –¥–ª—è —Ä–µ–∫—É—Ä—Å–∏–≤–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ `#include`-–¥–∏—Ä–µ–∫—Ç–∏–≤, –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ –ø—Ä–µ–ø—Ä–æ—Ü–µ—Å—Å–æ—Ä—É C/C++.

## üìë –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

- [–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏](#–≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏)
- [–ü—Ä–∏–º–µ—Ä —Å—Ç—Ä—É–∫—Ç—É—Ä—ã](#–ø—Ä–∏–º–µ—Ä-—Å—Ç—Ä—É–∫—Ç—É—Ä—ã)
- [–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è](#–ø—Ä–∏–º–µ—Ä-–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è)
- [–í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã](#–≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ-—Ç–µ—Å—Ç—ã)
- [–°–±–æ—Ä–∫–∞ –∏ –∑–∞–ø—É—Å–∫](#—Å–±–æ—Ä–∫–∞-–∏-–∑–∞–ø—É—Å–∫)
- [–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏](#–æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏-—Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏)
- [–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è](#—Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è)
- [–ü—Ä–∏–º–µ—Ä —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞](#–ø—Ä–∏–º–µ—Ä-—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞)

---

## –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- –û–±—Ä–∞–±–æ—Ç–∫–∞ `#include "file"` –∏ `#include <file>` —Å —Ä–µ–∫—É—Ä—Å–∏–µ–π
- –ü–æ–∏—Å–∫ –ø–æ —Ç–µ–∫—É—â–µ–π –ø–∞–ø–∫–µ –∏ include-–¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è–º
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≤–ª–æ–∂–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
- –°–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–µ —Å —É–∫–∞–∑–∞–Ω–∏–µ–º —Å—Ç—Ä–æ–∫–∏
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ `assert`

---

## –ü—Ä–∏–º–µ—Ä —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

```
sources/
‚îú‚îÄ‚îÄ a.cpp
‚îú‚îÄ‚îÄ a.in        # ‚Üê –≤—ã–≤–æ–¥
‚îú‚îÄ‚îÄ dir1/
‚îÇ   ‚îú‚îÄ‚îÄ b.h
‚îÇ   ‚îú‚îÄ‚îÄ d.h
‚îÇ   ‚îî‚îÄ‚îÄ subdir/
‚îÇ       ‚îî‚îÄ‚îÄ c.h
‚îú‚îÄ‚îÄ include1/
‚îÇ   ‚îî‚îÄ‚îÄ std1.h
‚îî‚îÄ‚îÄ include2/
    ‚îî‚îÄ‚îÄ lib/
        ‚îî‚îÄ‚îÄ std2.h
```

---

## –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

```cpp
bool Preprocess(
    const std::filesystem::path& input_file,
    const std::filesystem::path& output_file,
    const std::vector<std::filesystem::path>& include_dirs
);

Preprocess("sources/a.cpp", "sources/a.in", {
    "sources/include1",
    "sources/include2"
});
```

---

## –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã

`Test()`:

- –°–æ–∑–¥–∞—ë—Ç –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –∏ —Ñ–∞–π–ª—ã
- –í—ã–∑—ã–≤–∞–µ—Ç `Preprocess(...)`
- –°—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Å –æ–∂–∏–¥–∞–µ–º—ã–º —á–µ—Ä–µ–∑ `assert`

---

## –°–±–æ—Ä–∫–∞ –∏ –∑–∞–ø—É—Å–∫

```bash
g++ -std=c++17 -o preprocessor main.cpp
./preprocessor
```

---

## –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `std::regex` –¥–ª—è –ø–æ–∏—Å–∫–∞ include-—Å—Ç—Ä–æ–∫
- –†–µ–∫—É—Ä—Å–∏–≤–Ω–æ–µ –≤–∫–ª—é—á–µ–Ω–∏–µ —á–µ—Ä–µ–∑ `ProcessRecursInclude`
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ—Ö –ø—É—Ç–µ–π –ø–æ include-–¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è–º
- –°–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö —Å —É–∫–∞–∑–∞–Ω–∏–µ–º —Å—Ç—Ä–æ–∫–∏ –∏ —Ñ–∞–π–ª–∞

---

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- C++17
- –ü–æ–¥–∫–ª—é—á–∞–µ–º—ã–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏:
  - `<filesystem>`, `<fstream>`, `<regex>`, `<sstream>`
  - `<vector>`, `<string>`, `<iostream>`, `<cassert>`

---

## –ü—Ä–∏–º–µ—Ä —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞

```cpp
// this comment before include
// text from b.h before include
// text from c.h before include
// std1
// text from c.h after include
// text from b.h after include
// text between b.h and c.h
// text from d.h before include
// std2
// text from d.h after include

int SayHello() {
    cout << "hello, world!" << endl;
```

---

> –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Å–±–æ—Ä–∫–∏ –º–æ–Ω–æ–ª–∏—Ç–Ω—ã—Ö –∏—Å—Ö–æ–¥–Ω–∏–∫–æ–≤, –∞–Ω–∞–ª–∏–∑–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –∏–ª–∏ —ç–º—É–ª—è—Ü–∏–∏ –ø—Ä–µ–ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–∞.